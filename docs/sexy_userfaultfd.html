<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> üìö USERFAULTFD Manual </title>
    <link href="./index.css" rel="stylesheet">
</head>

<body>
    <header class="nav-header">
        <a href="./index.html" class="home-button">üè† Home</a>
    </header>
    <article>
        <div><h1>üìö USERFAULTFD Manual</h1><blockquote>*Beautiful, readable documentation for command-line tools*</blockquote><hr></hr><p>[<a href="./userfaultfd.html">userfaultfd(2)</a>](userfaultfd.html)                                                                              System Calls Manual                                                                              [<a href="./userfaultfd.html">userfaultfd(2)</a>](userfaultfd.html)</p><h2>üìë Table of Contents</h2><p>- <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#posix.1-2008.">Posix.1-2008.</a>   - <a href="#history">History</a>   - <a href="#posix.1-2001.">Posix.1-2001.</a>   - <a href="#notes">Notes</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#author">Author</a>   - <a href="#reporting-bugs">Reporting Bugs</a>   - <a href="#copyright">Copyright</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#author">Author</a>   - <a href="#reporting-bugs">Reporting Bugs</a>   - <a href="#copyright">Copyright</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#options">Options</a> - <a href="#authors">Authors</a> - <a href="#see-also">See Also</a>   - <a href="#reporting-bugs">Reporting Bugs</a>   - <a href="#availability">Availability</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#posix.1-2008.">Posix.1-2008.</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a> - <a href="#files">Files</a>   - <a href="#attributes">Attributes</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a>   - <a href="#target">Target</a> - <a href="#description">Description</a> - <a href="#options">Options</a> - <a href="#see-also">See Also</a>   - <a href="#copyright">Copyright</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#author">Author</a>   - <a href="#reporting-bugs">Reporting Bugs</a>   - <a href="#copyright">Copyright</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#environment">Environment</a> - <a href="#files">Files</a> - <a href="#see-also">See Also</a> - <a href="#authors">Authors</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#exit-status">Exit Status</a> - <a href="#environment">Environment</a> - <a href="#files">Files</a> - <a href="#see-also">See Also</a>   - <a href="#history">History</a>   - <a href="#bugs">Bugs</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#attributes">Attributes</a>   - <a href="#standards">Standards</a>   - <a href="#c11,-posix.1-2008.">C11, Posix.1-2008.</a>   - <a href="#history">History</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#seccomp_ret_errno">Seccomp_Ret_Errno</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a> - <a href="#examples">Examples</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#posix.1-2008.">Posix.1-2008.</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a>   - <a href="#bugs">Bugs</a> - <a href="#examples">Examples</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#notes">Notes</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#options">Options</a>   - <a href="#exit-status">Exit Status</a> - <a href="#environment">Environment</a> - <a href="#files">Files</a>   - <a href="#notes">Notes</a>   - <a href="#nfs">Nfs</a>   - <a href="#history">History</a> - <a href="#see-also">See Also</a>   - <a href="#reporting-bugs">Reporting Bugs</a>   - <a href="#availability">Availability</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a>   - <a href="#bugs">Bugs</a> - <a href="#examples">Examples</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#options">Options</a>   - <a href="#exit-codes">Exit Codes</a> - <a href="#see-also">See Also</a> - <a href="#examples">Examples</a> - <a href="#authors">Authors</a>   - <a href="#copyright">Copyright</a>   - <a href="#notes">Notes</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#exit-codes">Exit Codes</a> - <a href="#files">Files</a> - <a href="#environment">Environment</a>   - <a href="#lang,-language,-lc_ctype,-lc_numeric,-lc_time,-lc_collate,-lc_monetary,-lc_messages,-lc_paper,-lc_name,-lc_address,-lc_telephone,-lc_measurement,-lc_identification,-lc_all,-term,-path">Lang, Language, Lc_Ctype, Lc_Numeric, Lc_Time, Lc_Collate, Lc_Monetary, Lc_Messages, Lc_Paper, Lc_Name, Lc_Address, Lc_Telephone, Lc_Measurement, Lc_Identification, Lc_All, Term, Path</a> - <a href="#see-also">See Also</a>   - <a href="#author">Author</a>   - <a href="#copyright">Copyright</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#attributes">Attributes</a>   - <a href="#standards">Standards</a>   - <a href="#posix.1-2008.">Posix.1-2008.</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#posix.1-2008.">Posix.1-2008.</a>   - <a href="#history">History</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#options">Options</a>   - <a href="#parsing">Parsing</a>   - <a href="#output">Output</a>   - <a href="#quoting">Quoting</a>   - <a href="#scanning-modes">Scanning Modes</a>   - <a href="#compatibility">Compatibility</a>   - <a href="#return-codes">Return Codes</a> - <a href="#examples">Examples</a> - <a href="#environment">Environment</a>   - <a href="#posixly_correct">Posixly_Correct</a>   - <a href="#getopt_compatible">Getopt_Compatible</a>   - <a href="#bugs">Bugs</a>   - <a href="#author">Author</a> - <a href="#see-also">See Also</a>   - <a href="#reporting-bugs">Reporting Bugs</a>   - <a href="#availability">Availability</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#interactive-commands">Interactive Commands</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a> - <a href="#files">Files</a>   - <a href="#attributes">Attributes</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a> - <a href="#examples">Examples</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#examples">Examples</a>   - <a href="#reporting-bugs">Reporting Bugs</a>   - <a href="#copyright">Copyright</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#o_noctty">O_Noctty</a>   - <a href="#o_nofollow">O_Nofollow</a>   - <a href="#o_trunc">O_Trunc</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a>   - <a href="#nfs">Nfs</a>   - <a href="#o_direct">O_Direct</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#description">Description</a>   - <a href="#notes">Notes</a> - <a href="#examples">Examples</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#options">Options</a>   - <a href="#caveats">Caveats</a> - <a href="#files">Files</a>   - <a href="#exit-values">Exit Values</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#options">Options</a>   - <a href="#compatibility">Compatibility</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a>   - <a href="#reporting-bugs">Reporting Bugs</a>   - <a href="#availability">Availability</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#attributes">Attributes</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#attributes">Attributes</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#options">Options</a>   - <a href="#caveats">Caveats</a>   - <a href="#configuration">Configuration</a> - <a href="#files">Files</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#attributes">Attributes</a>   - <a href="#standards">Standards</a>   - <a href="#posix.1-2008.">Posix.1-2008.</a>   - <a href="#history">History</a>   - <a href="#posix.1-2001.">Posix.1-2001.</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#posix.1-2008.">Posix.1-2008.</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a>   - <a href="#nfs">Nfs</a> - <a href="#examples">Examples</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#eaddrnotavail">Eaddrnotavail</a>   - <a href="#eaddrnotavail">Eaddrnotavail</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#attributes">Attributes</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#author">Author</a>   - <a href="#reporting-bugs">Reporting Bugs</a>   - <a href="#copyright">Copyright</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#attributes">Attributes</a>   - <a href="#standards">Standards</a>   - <a href="#posix.1-2008.">Posix.1-2008.</a>   - <a href="#history">History</a> - <a href="#examples">Examples</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#bugs">Bugs</a> - <a href="#examples">Examples</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#attributes">Attributes</a>   - <a href="#standards">Standards</a>   - <a href="#posix.1-2008.">Posix.1-2008.</a>   - <a href="#history">History</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#files">Files</a> - <a href="#examples">Examples</a> - <a href="#see-also">See Also</a> - <a href="#authors">Authors</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#o_noctty">O_Noctty</a>   - <a href="#o_nofollow">O_Nofollow</a>   - <a href="#o_trunc">O_Trunc</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a>   - <a href="#nfs">Nfs</a>   - <a href="#o_direct">O_Direct</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#attributes">Attributes</a>   - <a href="#versions">Versions</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#posix.1-2008.">Posix.1-2008.</a>   - <a href="#history">History</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#default-key-bindings">Default Key Bindings</a>   - <a href="#command-parsing-and-execution">Command Parsing And Execution</a>   - <a href="#parsing-syntax">Parsing Syntax</a>   - <a href="#commands">Commands</a>   - <a href="#clients-and-sessions">Clients And Sessions</a>   - <a href="#windows-and-panes">Windows And Panes</a>   - <a href="#key-bindings">Key Bindings</a> - <a href="#options">Options</a>   - <a href="#hooks">Hooks</a>   - <a href="#mouse-support">Mouse Support</a>   - <a href="#formats">Formats</a>   - <a href="#styles">Styles</a>   - <a href="#names-and-titles">Names And Titles</a>   - <a href="#global-and-session-environment">Global And Session Environment</a>   - <a href="#status-line">Status Line</a>   - <a href="#buffers">Buffers</a>   - <a href="#miscellaneous">Miscellaneous</a>   - <a href="#exit-messages">Exit Messages</a>   - <a href="#terminfo-extensions">Terminfo Extensions</a>   - <a href="#control-mode">Control Mode</a> - <a href="#environment">Environment</a> - <a href="#files">Files</a> - <a href="#examples">Examples</a> - <a href="#see-also">See Also</a> - <a href="#authors">Authors</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#options">Options</a>   - <a href="#commands">Commands</a>   - <a href="#display-names">Display Names</a>   - <a href="#example">Example</a> - <a href="#environment">Environment</a> - <a href="#files">Files</a> - <a href="#see-also">See Also</a>   - <a href="#bugs">Bugs</a>   - <a href="#author">Author</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#options">Options</a> - <a href="#examples">Examples</a> - <a href="#see-also">See Also</a>   - <a href="#standards">Standards</a>   - <a href="#author">Author</a>   - <a href="#reporting-bugs">Reporting Bugs</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#bugs">Bugs</a>   - <a href="#author">Author</a>   - <a href="#reporting-bugs">Reporting Bugs</a>   - <a href="#copyright">Copyright</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#attributes">Attributes</a>   - <a href="#standards">Standards</a>   - <a href="#c11,-posix.1-2008.">C11, Posix.1-2008.</a>   - <a href="#history">History</a>   - <a href="#c89,-c99,-posix.1-2001.">C89, C99, Posix.1-2001.</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#options">Options</a>   - <a href="#configuration">Configuration</a> - <a href="#files">Files</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#description">Description</a>   - <a href="#standards">Standards</a>   - <a href="#notes">Notes</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#attributes">Attributes</a>   - <a href="#standards">Standards</a>   - <a href="#posix.1-2008.">Posix.1-2008.</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a>   - <a href="#bugs">Bugs</a> - <a href="#examples">Examples</a> - <a href="#see-also">See Also</a></p><h2 id="name">Name</h2><pre><code>userfaultfd - create a file descriptor for handling page faults in user space
</code></pre><h3 id="library">Library</h3><pre><code>Standard C library (libc, -lc)
</code></pre><h2 id="synopsis">Synopsis</h2><p>` #include <fcntl.h>             /* Definition of O_* constants */ #include <sys/syscall.h>       /* Definition of SYS_* constants */ #include <linux/userfaultfd.h> /* Definition of UFFD_* constants */ #include <unistd.h></p><p>int syscall(SYS_userfaultfd, int flags);</p><p>Note: glibc provides no wrapper for userfaultfd(), necessitating the use of <a href="./syscall.html">syscall(2)</a>. `</p><h2 id="description">Description</h2><p>` userfaultfd() creates a new userfaultfd object that can be used for delegation of page-fault handling to a user-space application, and returns a file descriptor that refers to the new object.  The new userfaultfd object is configured using <a href="./ioctl.html">ioctl(2)</a>.</p><p>Once the userfaultfd object is configured, the application can use <a href="./read.html">read(2)</a> to receive userfaultfd notifications.  The reads from userfaultfd may be blocking or non-blocking, depending on the value of flags used for the creation of the userfaultfd or subsequent calls to <a href="./fcntl.html">fcntl(2)</a>.</p><p>The following values may be bitwise ORed in flags to change the behavior of userfaultfd():</p><p>O_CLOEXEC        Enable the close-on-exec flag for the new userfaultfd file descriptor.  See the description of the O_CLOEXEC flag in <a href="./open.html">open(2)</a>.</p><p>O_NONBLOCK        Enables non-blocking operation for the userfaultfd object.  See the description of the O_NONBLOCK flag in <a href="./open.html">open(2)</a>.</p><p>UFFD_USER_MODE_ONLY        This  is an userfaultfd-specific flag that was introduced in Linux 5.11.  When set, the userfaultfd object will only be able to handle page faults originated from the user space on the reg‚Äê        istered regions.  When a kernel-originated fault was triggered on the registered range with this userfaultfd, a SIGBUS signal will be delivered.</p><p>When the last file descriptor referring to a userfaultfd object is closed, all memory ranges that were registered with the object are unregistered and unread events are flushed.</p><p>Userfaultfd supports three modes of registration:</p><p>UFFDIO_REGISTER_MODE_MISSING (since Linux 4.10)        When registered with UFFDIO_REGISTER_MODE_MISSING mode, user-space will receive a page-fault notification when a missing page is accessed.  The faulted thread will be stopped from execution        until the page fault is resolved from user-space by either an UFFDIO_COPY or an UFFDIO_ZEROPAGE ioctl.</p><p>UFFDIO_REGISTER_MODE_MINOR (since Linux 5.13)        When registered with UFFDIO_REGISTER_MODE_MINOR mode, user-space will receive a page-fault notification when a minor page fault occurs.  That is, when a backing page is in the  page  cache,        but page table entries don't yet exist.  The faulted thread will be stopped from execution until the page fault is resolved from user-space by an UFFDIO_CONTINUE ioctl.</p><p>UFFDIO_REGISTER_MODE_WP (since Linux 5.7)        When  registered with UFFDIO_REGISTER_MODE_WP mode, user-space will receive a page-fault notification when a write-protected page is written.  The faulted thread will be stopped from execu‚Äê        tion until user-space write-unprotects the page using an UFFDIO_WRITEPROTECT ioctl.</p><p>Multiple modes can be enabled at the same time for the same memory range.</p><p>Since Linux 4.14, a userfaultfd page-fault notification can selectively embed faulting thread ID information into the notification.  One needs to enable this feature explicitly using the UFFD_FEA‚Äê TURE_THREAD_ID feature bit when initializing the userfaultfd context.  By default, thread ID reporting is disabled. `</p><p>Usage ` The userfaultfd mechanism is designed to allow a thread in a multithreaded program to perform user-space paging for the other threads in the process.  When a page fault occurs for one of  the  re‚Äê gions  registered  to  the  userfaultfd object, the faulting thread is put to sleep and an event is generated that can be read via the userfaultfd file descriptor.  The fault-handling thread reads events from this file descriptor and services them using the operations described in <a href="./ioctl_userfaultfd.html">ioctl_userfaultfd(2)</a>.  When servicing the page fault events, the fault-handling thread can  trigger  a  wake-up for the sleeping thread.</p><p>It  is possible for the faulting threads and the fault-handling threads to run in the context of different processes.  In this case, these threads may belong to different programs, and the program that executes the faulting threads will not necessarily cooperate with the program that handles the page faults.  In such non-cooperative mode, the process that monitors  userfaultfd  and  handles page faults needs to be aware of the changes in the virtual memory layout of the faulting process to avoid memory corruption.</p><p>Since  Linux 4.11, userfaultfd can also notify the fault-handling threads about changes in the virtual memory layout of the faulting process.  In addition, if the faulting process invokes <a href="./fork.html">fork(2)</a>, the userfaultfd objects associated with the parent may be duplicated into the child process and the userfaultfd monitor will be notified (via the UFFD_EVENT_FORK described below)  about  the  file descriptor  associated  with the userfault objects created for the child process, which allows the userfaultfd monitor to perform user-space paging for the child process.  Unlike page faults which have to be synchronous and require an explicit or implicit wakeup, all other events are delivered asynchronously and the non-cooperative process resumes execution as soon as the  userfaultfd  man‚Äê ager executes <a href="./read.html">read(2)</a>.  The userfaultfd manager should carefully synchronize calls to UFFDIO_COPY with the processing of events.</p><p>The current asynchronous model of the event delivery is optimal for single threaded non-cooperative userfaultfd manager implementations.</p><p>Since  Linux  5.7, userfaultfd is able to do synchronous page dirty tracking using the new write-protect register mode.  One should check against the feature bit UFFD_FEATURE_PAGEFAULT_FLAG_WP be‚Äê fore using this feature.  Similar to the original userfaultfd missing mode, the write-protect mode will generate a userfaultfd notification when the protected page is written.  The user  needs  to resolve the page fault by unprotecting the faulted page and kicking the faulted thread to continue.  For more information, please refer to the "Userfaultfd write-protect mode" section. `</p><p>Userfaultfd operation ` After  the  userfaultfd object is created with userfaultfd(), the application must enable it using the UFFDIO_API <a href="./ioctl.html">ioctl(2)</a> operation.  This operation allows a two-step handshake between the kernel and user space to determine what API version and features the kernel supports, and then to enable those features user space wants.  This operation  must  be  performed  before  any  of  the  other <a href="./ioctl.html">ioctl(2)</a> operations described below (or those operations fail with the EINVAL error).</p><p>After a successful UFFDIO_API operation, the application then registers memory address ranges using the UFFDIO_REGISTER <a href="./ioctl.html">ioctl(2)</a> operation.  After successful completion of a UFFDIO_REGISTER opera‚Äê tion,  a  page fault occurring in the requested memory range, and satisfying the mode defined at the registration time, will be forwarded by the kernel to the user-space application.  The applica‚Äê tion can then use various (e.g., UFFDIO_COPY, UFFDIO_ZEROPAGE, or UFFDIO_CONTINUE) <a href="./ioctl.html">ioctl(2)</a> operations to resolve the page fault.</p><p>Since Linux 4.14, if the application sets the UFFD_FEATURE_SIGBUS feature bit using the UFFDIO_API <a href="./ioctl.html">ioctl(2)</a>, no page-fault notification will be forwarded to user space.  Instead a SIGBUS signal is delivered to the faulting process.  With this feature, userfaultfd can be used for robustness purposes to simply catch any access to areas within the registered address  range  that  do  not  have pages allocated, without having to listen to userfaultfd events.  No userfaultfd monitor will be required for dealing with such memory accesses.  For example, this feature can be useful for appli‚Äê cations that want to prevent the kernel from automatically allocating pages and filling holes in sparse files when the hole is accessed through a memory mapping.</p><p>The UFFD_FEATURE_SIGBUS feature is implicitly inherited through <a href="./fork.html">fork(2)</a> if used in combination with UFFD_FEATURE_FORK.</p><p>Details of the various <a href="./ioctl.html">ioctl(2)</a> operations can be found in <a href="./ioctl_userfaultfd.html">ioctl_userfaultfd(2)</a>.</p><p>Since Linux 4.11, events other than page-fault may enabled during UFFDIO_API operation.</p><p>Up to Linux 4.11, userfaultfd can be used only with anonymous private memory mappings.  Since Linux 4.11, userfaultfd can be also used with hugetlbfs and shared memory mappings. `</p><p>Userfaultfd write-protect mode (since Linux 5.7) ` Since  Linux 5.7, userfaultfd supports write-protect mode for anonymous memory.  The user needs to first check availability of this feature using UFFDIO_API ioctl against the feature bit UFFD_FEA‚Äê TURE_PAGEFAULT_FLAG_WP before using this feature.</p><p>Since Linux 5.19, the write-protection mode was also supported on shmem and hugetlbfs memory types.  It can be detected with the feature bit UFFD_FEATURE_WP_HUGETLBFS_SHMEM.</p><p>To register with userfaultfd write-protect mode, the user needs to initiate the UFFDIO_REGISTER ioctl with mode UFFDIO_REGISTER_MODE_WP set.  Note that it is legal to monitor the same memory range with multiple modes.  For example, the user can do UFFDIO_REGISTER with the mode set to UFFDIO_REGISTER_MODE_MISSING | UFFDIO_REGISTER_MODE_WP.  When there is only  UFFDIO_REGISTER_MODE_WP  regis‚Äê tered,  user-space  will not receive any notification when a missing page is written.  Instead, user-space will receive a write-protect page-fault notification only when an existing but write-pro‚Äê tected page got written.</p><p>After the UFFDIO_REGISTER ioctl completed with UFFDIO_REGISTER_MODE_WP mode set, the user can write-protect any existing memory within the range using  the  ioctl  UFFDIO_WRITEPROTECT  where  uff‚Äê dio_writeprotect.mode should be set to UFFDIO_WRITEPROTECT_MODE_WP.</p><p>When  a  write-protect  event  happens,  user-space will receive a page-fault notification whose uffd_msg.pagefault.flags will be with UFFD_PAGEFAULT_FLAG_WP flag set.  Note: since only writes can trigger this kind of fault, write-protect notifications will always have the UFFD_PAGEFAULT_FLAG_WRITE bit set along with the UFFD_PAGEFAULT_FLAG_WP bit.</p><p>To resolve a write-protection page fault, the user should initiate another UFFDIO_WRITEPROTECT ioctl, whose uffd_msg.pagefault.flags should have the flag UFFDIO_WRITEPROTECT_MODE_WP  cleared  upon the faulted page or range. `</p><p>Userfaultfd minor fault mode (since Linux 5.13) ` Since Linux 5.13, userfaultfd supports minor fault mode.  In this mode, fault messages are produced not for major faults (where the page was missing), but rather for minor faults, where a page ex‚Äê ists in the page cache, but the page table entries are not yet present.  The user needs to first check availability of this feature using the UFFDIO_API ioctl with the appropriate feature bits set before using this feature: UFFD_FEATURE_MINOR_HUGETLBFS since Linux 5.13, or UFFD_FEATURE_MINOR_SHMEM since Linux 5.14.</p><p>To register with userfaultfd minor fault mode, the user needs to initiate the UFFDIO_REGISTER ioctl with mode UFFD_REGISTER_MODE_MINOR set.</p><p>When a minor fault occurs, user-space will receive a page-fault notification whose uffd_msg.pagefault.flags will have the UFFD_PAGEFAULT_FLAG_MINOR flag set.</p><p>To  resolve  a  minor page fault, the handler should decide whether or not the existing page contents need to be modified first.  If so, this should be done in-place via a second, non-userfaultfd- registered mapping to the same backing page (e.g., by mapping the shmem or hugetlbfs file twice).  Once the page is considered "up to date", the fault can be resolved by initiating an  UFFDIO_CON‚Äê TINUE ioctl, which installs the page table entries and (by default) wakes up the faulting thread(s).</p><p>Minor fault mode supports only hugetlbfs-backed (since Linux 5.13) and shmem-backed (since Linux 5.14) memory. `</p><p>Reading from the userfaultfd structure ` Each  <a href="./read.html">read(2)</a>  from the userfaultfd file descriptor returns one or more uffd_msg structures, each of which describes a page-fault event or an event required for the non-cooperative userfaultfd us‚Äê age:</p><p>struct uffd_msg {         __u8  event;            /* Type of event */         ...         union {             struct {                 __u64 flags;    /* Flags describing fault */                 __u64 address;  /* Faulting address */                 union {                     __u32 ptid; /* Thread ID of the fault */                 } feat;             } pagefault;</p><p>struct {            /* Since Linux 4.11 */                 __u32 ufd;      /* Userfault file descriptor                                    of the child process */             } fork;</p><p>struct {            /* Since Linux 4.11 */                 __u64 from;     /* Old address of remapped area */                 __u64 to;       /* New address of remapped area */                 __u64 len;      /* Original mapping length */             } remap;</p><p>struct {            /* Since Linux 4.11 */                 __u64 start;    /* Start address of removed area */                 __u64 end;      /* End address of removed area */             } remove;             ...         } arg;</p><p>/* Padding fields omitted */     } __packed;</p><p>If multiple events are available and the supplied buffer is large enough, <a href="./read.html">read(2)</a> returns as many events as will fit in the supplied buffer.  If the buffer supplied to <a href="./read.html">read(2)</a> is smaller than  the size of the uffd_msg structure, the <a href="./read.html">read(2)</a> fails with the error EINVAL.</p><p>The fields set in the uffd_msg structure are as follows:</p><p>event  The  type  of  event.  Depending of the event type, different fields of the arg union represent details required for the event processing.  The non-page-fault events are generated only when        appropriate feature is enabled during API handshake with UFFDIO_API <a href="./ioctl.html">ioctl(2)</a>.</p><p>The following values can appear in the event field:</p><p>UFFD_EVENT_PAGEFAULT (since Linux 4.3)               A page-fault event.  The page-fault details are available in the pagefault field.</p><p>UFFD_EVENT_FORK (since Linux 4.11)               Generated when the faulting process invokes <a href="./fork.html">fork(2)</a> (or <a href="./clone.html">clone(2)</a> without the CLONE_VM flag).  The event details are available in the fork field.</p><p>UFFD_EVENT_REMAP (since Linux 4.11)               Generated when the faulting process invokes <a href="./mremap.html">mremap(2)</a>.  The event details are available in the remap field.</p><p>UFFD_EVENT_REMOVE (since Linux 4.11)               Generated when the faulting process invokes <a href="./madvise.html">madvise(2)</a> with MADV_DONTNEED or MADV_REMOVE advice.  The event details are available in the remove field.</p><p>UFFD_EVENT_UNMAP (since Linux 4.11)               Generated when the faulting process unmaps a memory range, either explicitly using <a href="./munmap.html">munmap(2)</a> or implicitly during <a href="./mmap.html">mmap(2)</a> or <a href="./mremap.html">mremap(2)</a>.  The event details are available in the remove               field.</p><p>pagefault.address        The address that triggered the page fault.</p><p>pagefault.flags        A bit mask of flags that describe the event.  For UFFD_EVENT_PAGEFAULT, the following flag may appear:</p><p>UFFD_PAGEFAULT_FLAG_WP               If this flag is set, then the fault was a write-protect fault.</p><p>UFFD_PAGEFAULT_FLAG_MINOR               If this flag is set, then the fault was a minor fault.</p><p>UFFD_PAGEFAULT_FLAG_WRITE               If this flag is set, then the fault was a write fault.</p><p>If neither UFFD_PAGEFAULT_FLAG_WP nor UFFD_PAGEFAULT_FLAG_MINOR are set, then the fault was a missing fault.</p><p>pagefault.feat.pid        The thread ID that triggered the page fault.</p><p>fork.ufd        The file descriptor associated with the userfault object created for the child created by <a href="./fork.html">fork(2)</a>.</p><p>remap.from        The original address of the memory range that was remapped using <a href="./mremap.html">mremap(2)</a>.</p><p>remap.to        The new address of the memory range that was remapped using <a href="./mremap.html">mremap(2)</a>.</p><p>remap.len        The original length of the memory range that was remapped using <a href="./mremap.html">mremap(2)</a>.</p><p>remove.start        The start address of the memory range that was freed using <a href="./madvise.html">madvise(2)</a> or unmapped</p><p>remove.end        The end address of the memory range that was freed using <a href="./madvise.html">madvise(2)</a> or unmapped</p><p>A <a href="./read.html">read(2)</a> on a userfaultfd file descriptor can fail with the following errors:</p><p>EINVAL The userfaultfd object has not yet been enabled using the UFFDIO_API <a href="./ioctl.html">ioctl(2)</a> operation</p><p>If the O_NONBLOCK flag is enabled in the associated open file description, the userfaultfd file descriptor can be monitored with <a href="./poll.html">poll(2)</a>, <a href="./select.html">select(2)</a>, and <a href="./epoll.html">epoll(7)</a>.  When events are  available,  the file  descriptor  indicates as readable.  If the O_NONBLOCK flag is not enabled, then <a href="./poll.html">poll(2)</a> (always) indicates the file as having a POLLERR condition, and <a href="./select.html">select(2)</a> indicates the file descriptor as both readable and writable. `</p><h3 id="return-value">Return Value</h3><pre><code>On success, userfaultfd() returns a new file descriptor that refers to the userfaultfd object.  On error, -1 is returned, and errno is set to indicate the error.
</code></pre><h3 id="errors">Errors</h3><p>` EINVAL An unsupported value was specified in flags.</p><p>EMFILE The per-process limit on the number of open file descriptors has been reached</p><p>ENFILE The system-wide limit on the total number of open files has been reached.</p><p>ENOMEM Insufficient kernel memory was available.</p><p>EPERM (since Linux 5.2)        The caller is not privileged (does not have the CAP_SYS_PTRACE capability in the initial user namespace), and /proc/sys/vm/unprivileged_userfaultfd has the value 0. `</p><h3 id="standards">Standards</h3><pre><code>Linux.
</code></pre><h3 id="history">History</h3><p>` Linux 4.3.</p><p>Support for hugetlbfs and shared memory areas and non-page-fault events was added in Linux 4.11 `</p><h3 id="notes">Notes</h3><pre><code>The userfaultfd mechanism can be used as an alternative to traditional user-space paging techniques based on the use of the SIGSEGV signal and mmap(2).  It can also be used to implement  lazy  re‚Äê
store for checkpoint/restore mechanisms, as well as post-copy migration to allow (nearly) uninterrupted execution when transferring virtual machines and Linux containers from one host to another.
</code></pre><h3 id="bugs">Bugs</h3><pre><code>If the UFFD_FEATURE_EVENT_FORK is enabled and a system call from the fork(2) family is interrupted by a signal or failed, a stale userfaultfd descriptor might be created.  In this case, a spurious
UFFD_EVENT_FORK will be delivered to the userfaultfd monitor.
</code></pre><h2 id="examples">Examples</h2><p>` The  program  below demonstrates the use of the userfaultfd mechanism.  The program creates two threads, one of which acts as the page-fault handler for the process, for the pages in a demand-page zero region created using <a href="./mmap.html">mmap(2)</a>.</p><p>The program takes one command-line argument, which is the number of pages that will be created in a mapping whose page faults will be handled via userfaultfd.  After creating a userfaultfd object, the program then creates an anonymous private mapping of the specified size and registers the address range of that mapping using the UFFDIO_REGISTER <a href="./ioctl.html">ioctl(2)</a> operation.  The program then  creates a second thread that will perform the task of handling page faults.</p><p>The  main thread then walks through the pages of the mapping fetching bytes from successive pages.  Because the pages have not yet been accessed, the first access of a byte in each page will trig‚Äê ger a page-fault event on the userfaultfd file descriptor.</p><p>Each of the page-fault events is handled by the second thread, which sits in a loop processing input from the userfaultfd file descriptor.  In each loop iteration, the second  thread  first  calls <a href="./poll.html">poll(2)</a>  to  check the state of the file descriptor, and then reads an event from the file descriptor.  All such events should be UFFD_EVENT_PAGEFAULT events, which the thread handles by copying a page of data into the faulting region using the UFFDIO_COPY <a href="./ioctl.html">ioctl(2)</a> operation.</p><p>The following is an example of what we see when running the program:</p><p>$ ./userfaultfd_demo 3     Address returned by mmap() = 0x7fd30106c000</p><p>fault_handler_thread():         poll() returns: nready = 1; POLLIN = 1; POLLERR = 0         UFFD_EVENT_PAGEFAULT event: flags = 0; address = 7fd30106c00f             (uffdio_copy.copy returned 4096)     Read address 0x7fd30106c00f in main(): A     Read address 0x7fd30106c40f in main(): A     Read address 0x7fd30106c80f in main(): A     Read address 0x7fd30106cc0f in main(): A</p><p>fault_handler_thread():         poll() returns: nready = 1; POLLIN = 1; POLLERR = 0         UFFD_EVENT_PAGEFAULT event: flags = 0; address = 7fd30106d00f             (uffdio_copy.copy returned 4096)     Read address 0x7fd30106d00f in main(): B     Read address 0x7fd30106d40f in main(): B     Read address 0x7fd30106d80f in main(): B     Read address 0x7fd30106dc0f in main(): B</p><p>fault_handler_thread():         poll() returns: nready = 1; POLLIN = 1; POLLERR = 0         UFFD_EVENT_PAGEFAULT event: flags = 0; address = 7fd30106e00f             (uffdio_copy.copy returned 4096)     Read address 0x7fd30106e00f in main(): C     Read address 0x7fd30106e40f in main(): C     Read address 0x7fd30106e80f in main(): C     Read address 0x7fd30106ec0f in main(): C `</p><p>Program source</p><p>` /* userfaultfd_demo.c</p><p>Licensed under the GNU General Public License version 2 or later. */ #define _GNU_SOURCE #include <err.h> #include <errno.h> #include <fcntl.h> #include <inttypes.h> #include <linux/userfaultfd.h> #include <poll.h> #include <pthread.h> #include <stdio.h> #include <stdlib.h> #include <string.h> #include <sys/ioctl.h> #include <sys/mman.h> #include <sys/syscall.h> #include <unistd.h></p><p>static int page_size;</p><p>static void * fault_handler_thread(void *arg) {     int                 nready;     long                uffd;   /* userfaultfd file descriptor */     ssize_t             nread;     struct pollfd       pollfd;     struct uffdio_copy  uffdio_copy;</p><p>static int      fault_cnt = 0; /* Number of faults so far handled */     static char     *page = NULL;     static struct uffd_msg  msg;  /* Data read from userfaultfd */</p><p>uffd = (long) arg;</p><p>/* Create a page that will be copied into the faulting region. */</p><p>if (page == NULL) {         page = mmap(NULL, page_size, PROT_READ | PROT_WRITE,                     MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);         if (page == MAP_FAILED)             err(EXIT_FAILURE, "mmap");     }</p><p>/* Loop, handling incoming events on the userfaultfd        file descriptor. */</p><p>for (;;) {</p><p>/* See what poll() tells us about the userfaultfd. */</p><p>pollfd.fd = uffd;         pollfd.events = POLLIN;         nready = poll(&pollfd, 1, -1);         if (nready == -1)             err(EXIT_FAILURE, "poll");</p><p>printf("\nfault_handler_thread():\n");         printf("    poll() returns: nready = %d; "                "POLLIN = %d; POLLERR = %d\n", nready,                (pollfd.revents & POLLIN) != 0,                (pollfd.revents & POLLERR) != 0);</p><p>/* Read an event from the userfaultfd. */</p><p>nread = read(uffd, &msg, sizeof(msg));         if (nread == 0) {             printf("EOF on userfaultfd!\n");             exit(EXIT_FAILURE);         }</p><p>if (nread == -1)             err(EXIT_FAILURE, "read");</p><p>/* We expect only one kind of event; verify that assumption. */</p><p>if (msg.event != UFFD_EVENT_PAGEFAULT) {             fprintf(stderr, "Unexpected event on userfaultfd\n");             exit(EXIT_FAILURE);         }</p><p>/* Display info about the page-fault event. */</p><p>printf("    UFFD_EVENT_PAGEFAULT event: ");         printf("flags = %"PRIx64"; ", msg.arg.pagefault.flags);         printf("address = %"PRIx64"\n", msg.arg.pagefault.address);</p><p>/* Copy the page pointed to by 'page' into the faulting            region. Vary the contents that are copied in, so that it            is more obvious that each fault is handled separately. */</p><p>memset(page, 'A' + fault_cnt % 20, page_size);         fault_cnt++;</p><p>uffdio_copy.src = (unsigned long) page;</p><p>/* We need to handle page faults in units of pages(!).            So, round faulting address down to page boundary. */</p><p>uffdio_copy.dst = (unsigned long) msg.arg.pagefault.address &                                            ~(page_size - 1);         uffdio_copy.len = page_size;         uffdio_copy.mode = 0;         uffdio_copy.copy = 0;         if (ioctl(uffd, UFFDIO_COPY, &uffdio_copy) == -1)             err(EXIT_FAILURE, "ioctl-UFFDIO_COPY");</p><p>printf("        (uffdio_copy.copy returned %"PRId64")\n",                uffdio_copy.copy);     } }</p><p>int main(int argc, char *argv[]) {     int        s;     char       c;     char       *addr;   /* Start of region handled by userfaultfd */     long       uffd;    /* userfaultfd file descriptor */     size_t     len, l;  /* Length of region handled by userfaultfd */     pthread_t  thr;     /* ID of thread that handles page faults */     struct uffdio_api       uffdio_api;     struct uffdio_register  uffdio_register;</p><p>if (argc != 2) {         fprintf(stderr, "Usage: %s num-pages\n", argv[0]);         exit(EXIT_FAILURE);     }</p><p>page_size = sysconf(_SC_PAGE_SIZE);     len = strtoull(argv[1], NULL, 0) * page_size;</p><p>/* Create and enable userfaultfd object. */</p><p>uffd = syscall(SYS_userfaultfd, O_CLOEXEC | O_NONBLOCK);     if (uffd == -1)         err(EXIT_FAILURE, "userfaultfd");</p><p>/* NOTE: Two-step feature handshake is not needed here, since this        example doesn't require any specific features.</p><p>Programs that *do* should call UFFDIO_API twice: once with        <code>features = 0</code> to detect features supported by this kernel, and        again with the subset of features the program actually wants to        enable. */     uffdio_api.api = UFFD_API;     uffdio_api.features = 0;     if (ioctl(uffd, UFFDIO_API, &uffdio_api) == -1)         err(EXIT_FAILURE, "ioctl-UFFDIO_API");</p><p>/* Create a private anonymous mapping. The memory will be        demand-zero paged--that is, not yet allocated. When we        actually touch the memory, it will be allocated via        the userfaultfd. */</p><p>addr = mmap(NULL, len, PROT_READ | PROT_WRITE,                 MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);     if (addr == MAP_FAILED)         err(EXIT_FAILURE, "mmap");</p><p>printf("Address returned by mmap() = %p\n", addr);</p><p>/* Register the memory range of the mapping we just created for        handling by the userfaultfd object. In mode, we request to track        missing pages (i.e., pages that have not yet been faulted in). */</p><p>uffdio_register.range.start = (unsigned long) addr;     uffdio_register.range.len = len;     uffdio_register.mode = UFFDIO_REGISTER_MODE_MISSING;     if (ioctl(uffd, UFFDIO_REGISTER, &uffdio_register) == -1)         err(EXIT_FAILURE, "ioctl-UFFDIO_REGISTER");</p><p>/* Create a thread that will process the userfaultfd events. */</p><p>s = pthread_create(&thr, NULL, fault_handler_thread, (void *) uffd);     if (s != 0) {         errc(EXIT_FAILURE, s, "pthread_create");     }</p><p>/* Main thread now touches memory in the mapping, touching        locations 1024 bytes apart. This will trigger userfaultfd        events for all pages in the region. */</p><p>l = 0xf;    /* Ensure that faulting address is not on a page                    boundary, in order to test that we correctly                    handle that case in fault_handling_thread(). */     while (l < len) {         c = addr[l];         printf("Read address %p in %s(): ", addr + l, __func__);         printf("%c\n", c);         l += 1024;         <a href="./usleep.html">usleep(100000)</a>;         /* Slow things down a little */     }</p><p>exit(EXIT_SUCCESS); } `</p><h2 id="see-also">See Also</h2><p>` <a href="./fcntl.html">fcntl(2)</a>, <a href="./ioctl.html">ioctl(2)</a>, <a href="./ioctl_userfaultfd.html">ioctl_userfaultfd(2)</a>, <a href="./madvise.html">madvise(2)</a>, <a href="./mmap.html">mmap(2)</a></p><p>Documentation/admin-guide/mm/userfaultfd.rst in the Linux kernel source tree `</p><p>Linux man-pages 6.7                                                                              2024-02-12                                                                                  [<a href="./userfaultfd.html">userfaultfd(2)</a>](userfaultfd.html)</p></div>
    </article>
</body>

</html>
