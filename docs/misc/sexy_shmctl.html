<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> üìö SHMCTL Manual </title>
    <link href="./index.css" rel="stylesheet">
</head>

<body>
    <header class="nav-header">
        <a href="./index.html" class="home-button">üè† Home</a>
    </header>
    <article>
        <div><h1>üìö SHMCTL Manual</h1><blockquote>*Beautiful, readable documentation for command-line tools*</blockquote><hr></hr><p>[<a href="./shmctl.html">shmctl(2)</a>](shmctl.html)                     System Calls Manual                    [<a href="./shmctl.html">shmctl(2)</a>](shmctl.html)</p><h2>üìë Table of Contents</h2><p>- <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a> - <a href="#examples">Examples</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#bugs">Bugs</a>   - <a href="#author">Author</a>   - <a href="#reporting-bugs">Reporting Bugs</a>   - <a href="#copyright">Copyright</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#attributes">Attributes</a>   - <a href="#standards">Standards</a>   - <a href="#posix.1-2008.">Posix.1-2008.</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#standards">Standards</a>   - <a href="#posix.1-2008.">Posix.1-2008.</a>   - <a href="#history">History</a>   - <a href="#posix.1-2001.">Posix.1-2001.</a>   - <a href="#notes">Notes</a>   - <a href="#bugs">Bugs</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#author">Author</a>   - <a href="#reporting-bugs">Reporting Bugs</a>   - <a href="#copyright">Copyright</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#author">Author</a>   - <a href="#reporting-bugs">Reporting Bugs</a>   - <a href="#copyright">Copyright</a> - <a href="#see-also">See Also</a> - <a href="#name">Name</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a> - <a href="#options">Options</a> - <a href="#authors">Authors</a> - <a href="#see-also">See Also</a>   - <a href="#reporting-bugs">Reporting Bugs</a>   - <a href="#availability">Availability</a> - <a href="#name">Name</a>   - <a href="#library">Library</a> - <a href="#synopsis">Synopsis</a> - <a href="#description">Description</a>   - <a href="#return-value">Return Value</a>   - <a href="#errors">Errors</a>   - <a href="#versions">Versions</a>   - <a href="#standards">Standards</a>   - <a href="#posix.1-2008.">Posix.1-2008.</a>   - <a href="#history">History</a>   - <a href="#notes">Notes</a> - <a href="#see-also">See Also</a></p><h2 id="name">Name</h2><pre><code>shmctl - System V shared memory control
</code></pre><h3 id="library">Library</h3><pre><code>Standard C library (libc, -lc)
</code></pre><h2 id="synopsis">Synopsis</h2><p>` #include <sys/shm.h></p><p>int shmctl(int shmid, int op, struct shmid_ds *buf); `</p><h2 id="description">Description</h2><p>` shmctl() performs the control operation specified by op on the System V shared memory segment whose identifier is given in shmid.</p><p>The  buf  argument  is  a  pointer  to a shmid_ds structure, defined in <sys/shm.h> as follows:</p><p>struct shmid_ds {         struct ipc_perm shm_perm;    /* Ownership and permissions */         size_t          shm_segsz;   /* Size of segment (bytes) */         time_t          shm_atime;   /* Last attach time */         time_t          shm_dtime;   /* Last detach time */         time_t          shm_ctime;   /* Creation time/time of last                                         modification via shmctl() */         pid_t           shm_cpid;    /* PID of creator */         pid_t           shm_lpid;    /* PID of last <a href="./shmat.html">shmat(2)</a>/<a href="./shmdt.html">shmdt(2)</a> */         shmatt_t        shm_nattch;  /* No. of current attaches */         ...     };</p><p>The fields of the shmid_ds structure are as follows:</p><p>shm_perm    This is an ipc_perm structure (see  below)  that  specifies             the access permissions on the shared memory segment.</p><p>shm_segsz   Size in bytes of the shared memory segment.</p><p>shm_atime   Time  of  the  last <a href="./shmat.html">shmat(2)</a> system call that attached this             segment.</p><p>shm_dtime   Time of the last <a href="./shmdt.html">shmdt(2)</a> system call  that  detached  tgis             segment.</p><p>shm_ctime   Time  of  creation  of segment or time of the last shmctl()             IPC_SET operation.</p><p>shm_cpid    ID of the process that created the shared memory segment.</p><p>shm_lpid    ID of the last process that executed a <a href="./shmat.html">shmat(2)</a> or <a href="./shmdt.html">shmdt(2)</a>             system call on this segment.</p><p>shm_nattch  Number of processes that have this segment attached.</p><p>The ipc_perm structure is defined as follows  (the  highlighted  fields are settable using IPC_SET):</p><p>struct ipc_perm {         key_t          __key;    /* Key supplied to <a href="./shmget.html">shmget(2)</a> */         uid_t          uid;      /* Effective UID of owner */         gid_t          gid;      /* Effective GID of owner */         uid_t          cuid;     /* Effective UID of creator */         gid_t          cgid;     /* Effective GID of creator */         unsigned short mode;     /* Permissions + SHM_DEST and                                     SHM_LOCKED flags */         unsigned short __seq;    /* Sequence number */     };</p><p>The  least  significant 9 bits of the mode field of the ipc_perm struc‚Äê ture define the access permissions for the shared memory segment.   The permission bits are as follows: 0400   Read by user 0200   Write by user 0040   Read by group 0020   Write by group 0004   Read by others 0002   Write by others</p><p>Bits  0100, 0010, and 0001 (the execute bits) are unused by the system. (It is not necessary to have execute permission on a segment  in  order to perform a <a href="./shmat.html">shmat(2)</a> call with the SHM_EXEC flag.)</p><p>Valid values for op are:</p><p>IPC_STAT        Copy  information from the kernel data structure associated with        shmid into the shmid_ds structure pointed to by buf.  The caller        must have read permission on the shared memory segment.</p><p>IPC_SET        Write the values of  some  members  of  the  shmid_ds  structure        pointed  to  by buf to the kernel data structure associated with        this shared memory segment, updating also its shm_ctime member.</p><p>The following fields are  updated:  shm_perm.uid,  shm_perm.gid,        and (the least significant 9 bits of) shm_perm.mode.</p><p>The  effective  UID  of the calling process must match the owner        (shm_perm.uid) or creator (shm_perm.cuid) of the  shared  memory        segment, or the caller must be privileged.</p><p>IPC_RMID        Mark  the segment to be destroyed.  The segment will actually be        destroyed only after the last process detaches  it  (i.e.,  when        the  shm_nattch  member  of the associated structure shmid_ds is        zero).  The caller must be the owner or creator of the  segment,        or be privileged.  The buf argument is ignored.</p><p>If a segment has been marked for destruction, then the (nonstan‚Äê        dard) SHM_DEST flag of the shm_perm.mode field in the associated        data structure retrieved by IPC_STAT will be set.</p><p>The  caller  must ensure that a segment is eventually destroyed;        otherwise its pages that were faulted in will remain  in  memory        or swap.</p><p>See  also the description of /proc/sys/kernel/shm_rmid_forced in        <a href="./proc.html">proc(5)</a>.</p><p>IPC_INFO (Linux-specific)        Return information about system-wide shared  memory  limits  and        parameters  in  the structure pointed to by buf.  This structure        is of type shminfo  (thus,  a  cast  is  required),  defined  in        <sys/shm.h> if the _GNU_SOURCE feature test macro is defined:</p><p>struct shminfo {                unsigned long shmmax; /* Maximum segment size */                unsigned long shmmin; /* Minimum segment size;                                         always 1 */                unsigned long shmmni; /* Maximum number of segments */                unsigned long shmseg; /* Maximum number of segments                                         that a process can attach;                                         unused within kernel */                unsigned long shmall; /* Maximum number of pages of                                         shared memory, system-wide */            };</p><p>The shmmni, shmmax, and shmall settings can be changed via /proc        files of the same name; see <a href="./proc.html">proc(5)</a> for details.</p><p>SHM_INFO (Linux-specific)        Return  a  shm_info  structure  whose fields contain information        about system resources consumed by shared memory.   This  struc‚Äê        ture  is  defined in <sys/shm.h> if the _GNU_SOURCE feature test        macro is defined:</p><p>struct shm_info {                int           used_ids; /* # of currently existing                                           segments */                unsigned long shm_tot;  /* Total number of shared                                           memory pages */                unsigned long shm_rss;  /* # of resident shared                                           memory pages */                unsigned long shm_swp;  /* # of swapped shared                                           memory pages */                unsigned long swap_attempts;                                        /* Unused since Linux 2.4 */                unsigned long swap_successes;                                        /* Unused since Linux 2.4 */            };</p><p>SHM_STAT (Linux-specific)        Return a shmid_ds structure as for IPC_STAT.  However, the shmid        argument is not a segment identifier, but instead an index  into        the kernel's internal array that maintains information about all        shared memory segments on the system.</p><p>SHM_STAT_ANY (Linux-specific, since Linux 4.17)        Return   a   shmid_ds   structure  as  for  SHM_STAT.   However,        shm_perm.mode is not checked for read access for shmid,  meaning        that  any  user  can employ this operation (just as any user may        read /proc/sysvipc/shm to obtain the same information).</p><p>The caller can prevent or allow swapping of  a  shared  memory  segment with the following op values:</p><p>SHM_LOCK (Linux-specific)        Prevent  swapping of the shared memory segment.  The caller must        fault in any pages that are required to be present after locking        is enabled.  If a segment has been locked,  then  the  (nonstan‚Äê        dard)  SHM_LOCKED flag of the shm_perm.mode field in the associ‚Äê        ated data structure retrieved by IPC_STAT will be set.</p><p>SHM_UNLOCK (Linux-specific)        Unlock the segment, allowing it to be swapped out.</p><p>Before Linux 2.6.10, only a privileged process  could  employ  SHM_LOCK and SHM_UNLOCK.  Since Linux 2.6.10, an unprivileged process can employ these  operations if its effective UID matches the owner or creator UID of the segment, and (for SHM_LOCK) the amount of memory  to  be  locked falls within the RLIMIT_MEMLOCK resource limit (see <a href="./setrlimit.html">setrlimit(2)</a>). `</p><h3 id="return-value">Return Value</h3><p>` A  successful  IPC_INFO  or SHM_INFO operation returns the index of the highest used entry in the kernel's internal array recording information about all shared memory segments.  (This information can be  used  with repeated  SHM_STAT  or  SHM_STAT_ANY  operations  to obtain information about all shared memory segments on the system.)  A successful SHM_STAT operation returns the identifier of the shared memory segment whose in‚Äê dex was given in shmid.  Other operations return 0 on success.</p><p>On error, -1 is returned, and errno is set to indicate the error. `</p><h3 id="errors">Errors</h3><p>` EACCES IPC_STAT or SHM_STAT is requested and shm_perm.mode does not al‚Äê        low read access for shmid, and the calling process does not have        the CAP_IPC_OWNER capability in the user namespace that  governs        its IPC namespace.</p><p>EFAULT The  argument  op  has value IPC_SET or IPC_STAT but the address        pointed to by buf isn't accessible.</p><p>EIDRM  shmid points to a removed identifier.</p><p>EINVAL shmid is not a valid identifier, or op is not a valid operation.        Or: for a SHM_STAT or SHM_STAT_ANY operation,  the  index  value        specified  in  shmid referred to an array slot that is currently        unused.</p><p>ENOMEM (Since Linux 2.6.9), SHM_LOCK was specified and the size of  the        to-be-locked  segment  would mean that the total bytes in locked        shared memory segments would exceed the limit for the real  user        ID  of  the  calling  process.   This  limit  is  defined by the        RLIMIT_MEMLOCK soft resource limit (see <a href="./setrlimit.html">setrlimit(2)</a>).</p><p>EOVERFLOW        IPC_STAT is attempted, and the GID or UID value is too large  to        be stored in the structure pointed to by buf.</p><p>EPERM  IPC_SET  or  IPC_RMID is attempted, and the effective user ID of        the calling process  is  not  that  of  the  creator  (found  in        shm_perm.cuid),  or  the  owner (found in shm_perm.uid), and the        process was not privileged (Linux: did not have the  CAP_SYS_AD‚Äê        MIN capability).</p><p>Or  (before  Linux 2.6.9), SHM_LOCK or SHM_UNLOCK was specified,        but the process was not privileged  (Linux:  did  not  have  the        CAP_IPC_LOCK  capability).   (Since  Linux 2.6.9, this error can        also occur if the RLIMIT_MEMLOCK is 0  and  the  caller  is  not        privileged.) `</p><h3 id="versions">Versions</h3><pre><code>Linux  permits  a  process to attach (shmat(2)) a shared memory segment
that has already been marked for deletion using shmctl(IPC_RMID).  This
feature is not available on other UNIX implementations; portable appli‚Äê
cations should avoid relying on it.
</code></pre><h3 id="standards">Standards</h3><h3 id="posix.1-2008.">Posix.1-2008.</h3><h3 id="history">History</h3><p>` POSIX.1-2001, SVr4.</p><p>Various fields in a struct shmid_ds were typed as short under Linux 2.2 and have become long under Linux 2.4.  To take advantage of this, a re‚Äê compilation under glibc-2.1.91 or later should  suffice.   (The  kernel distinguishes old and new calls by an IPC_64 flag in op.) `</p><h3 id="notes">Notes</h3><pre><code>The IPC_INFO, SHM_STAT, and SHM_INFO operations are used by the ipcs(1)
program  to provide information on allocated resources.  In the future,
these may modified or moved to a /proc filesystem interface.
</code></pre><h2 id="see-also">See Also</h2><pre><code>mlock(2),   setrlimit(2),   shmget(2),    shmop(2),    capabilities(7),
sysvipc(7)
</code></pre><p>Linux man-pages 6.7               2024-03-03                         [<a href="./shmctl.html">shmctl(2)</a>](shmctl.html)</p></div>
    </article>
</body>

</html>
